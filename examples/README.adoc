== Examples

=== Definitions

The following definitions are used in the description below:

- <device>

	The file system path or subsystem-specific identification string of a FIDO device.

- <pin>, [oldpin]

	Strings passed directly in the executed command's argument vector.

- <cred_id>

	The file system path of a file containing a FIDO credential ID in binary representation.

- <pubkey>

	The file system path of a file containing a public key in PEM format.

- <blobkey>

	A credential's associated CTAP 2.1 "largeBlob" symmetric key.

=== Description

The following examples are provided:

==== manifest

Prints a list of configured FIDO devices.

==== info

	info <device>

Prints information about <device>.

==== reset 

	reset <device>

Performs a factory reset on <device>.

==== setpin
 
	setpin <pin> [oldpin] <device>

Configures <pin> as the new PIN of <device>. If [oldpin] is provided, the device's PIN is changed from [oldpin] to <pin>.

==== cred

	cred [-t es256|es384|rs256|eddsa] [-k pubkey] [-ei cred_id] [-P pin] [-T seconds] [-b blobkey] [-hruv] [-c cred_protect] <device>

Creates a new credential on <device> and verify that the credential was signed by the authenticator. The device's attestation certificate is not verified. If option -k is specified, the credential's public key is stored in <pubkey>. If option -i is specified, the credential ID is stored in <cred_id>. The -e option may be used to add <cred_id> to the list of excluded credentials. If option -h is specified, the hmac-secret FIDO2 extension is enabled on the generated credential. If option -r is specified, the generated credential will involve a resident key. User verification may be requested through the -v option. If option -u is specified, the credential is generated using U2F (CTAP1) instead of FIDO2 (CTAP2) commands. The -T option may be used to enforce a timeout of <seconds>. If the option -b is specified, the credential's "largeBlob" key is stored in <blobkey>. If the option -c is specified the the generated credential will be bound by the specified protection policy. If the option -a is specified, enterprise attestation will be requested.

==== assert

	assert [-p] [-v] [-u] [-s hmac_salt] [-h hmac_secret] [-T seconds] [-b blobkey] <pubkey> <device>

Asks <device> for a FIDO2 assertion corresponding to [cred_id], which may be omitted for resident keys. The obtained assertion is verified using <pubkey>. The -p option requests that the user be present and checks whether the user presence bit was signed by the authenticator. The -v option requests user verification and checks whether the user verification bit was signed by the authenticator. If option -u is specified, the assertion is generated using U2F (CTAP1) instead of FIDO2 (CTAP2) commands. If option -s is specified, a FIDO2 hmac-secret is requested from the authenticator, and the contents of <hmac_salt> are used as the salt. If option -h is specified, the resulting hmac-secret is stored in <hmac_secret>. The -T option may be used to enforce a timeout of <seconds>. If the option -b specified, the credential's "largeBlob" key is stored in <blobkey>.

==== retries

	retries <device>
	
Get the number of PIN attempts left on <device> before lockout.

==== select

	select

Enumerates available FIDO devices and, if more than one is present, simultaneously requests touch on all of them, printing information about the device touched.

==== prf

	prf -M [-P pin] <device>
	prf -E [-P pin] <device> <cred_id_hex> <message>
	prf -D [-P pin] <device> <cred_id_hex> <ciphertext_hex>

Demonstrates hardware-backed, end-to-end encryption using the CTAP2 hmac-secret extension. Creates a FIDO2 credential with PRF capability, then uses it to encrypt and decrypt messages with AES-256-GCM. The -P option specifies the device PIN when required.

This tool serves as a reference implementation for developers building applications that require strong, phishing-resistant, client-side encryption. While demonstrating modern cryptographic best practices, it is intended as an educational example requiring security review for production use.

Complete workflow:

Step 1: Create PRF-enabled credential

	$ ./prf -M /dev/hidraw0
	5c22fd1c8495c766cc3c703942c82f2b83b297fcf3a08702d42ddd44ba4a57e8b26e5e2ce1f3e88de44ea3656074281c325a4616c136a44cfe2f8569115c1b72
	c981b6a81cdbb892ea111076fd41954886d9597b853bcbb877302e202efdce0492513e27819fa7c8b45b00547fb92cdd963d3cea7340e9a297aec6a1365b496a

Save the first line as credential ID

Step 2: Encrypt a message

	$ ./prf -E /dev/hidraw0 5c22fd1c8495c766cc3c703942c82f2b83b297fcf3a08702d42ddd44ba4a57e8b26e5e2ce1f3e88de44ea3656074281c325a4616c136a44cfe2f8569115c1b72 "Hello, secure world"
	38ff23dbe1e271a09bbf72ca
	28e4daa98e639cbf66c503fd8e271b331a50e6e7a7
	fc4b20aefc7890537229e79439f5c89a

Step 3: Decrypt the message (combine the three hex strings)

	$ ./prf -D /dev/hidraw0 5c22fd1c8495c766cc3c703942c82f2b83b297fcf3a08702d42ddd44ba4a57e8b26e5e2ce1f3e88de44ea3656074281c325a4616c136a44cfe2f8569115c1b72 38ff23dbe1e271a09bbf72ca28e4daa98e639cbf66c503fd8e271b331a50e6e7a7fc4b20aefc7890537229e79439f5c89a
	Hello, secure world


Debugging is possible through the use of the FIDO_DEBUG environment variable.
If set, libfido2 will produce a log of its transactions with the authenticator.

Additionally, an example of a WebAuthn client using libfido2 is available at
https://github.com/martelletto/fido2-webauthn-client.
